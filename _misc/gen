#!/bin/bash

root=$(cd $(dirname $0) && pwd)/..
out=$root/README.md

git_latest_tag=$(git describe --tags --abbrev=0)
cat $root/_misc/readme.header.md | sed -e "s/GIT_LATEST_TAG/$git_latest_tag/g" > $out

# example code
echo "" >> $out
echo "## Example" >> $out
echo '```go' >> $out
cat _example/example_test.go >> $out
echo '```' >> $out

# example result
echo "" >> $out
echo '```' >> $out
echo '$ gopwt' >> $out
cd _example
gopwt 2>&1 | sed -e "s,FAIL .*/src,FAIL /.../src,g; s/	[0-9\.]*s$//g" >> $out
echo '```' >> $out
echo "" >> $out

cat $root/_misc/readme.footer.md >> $out
